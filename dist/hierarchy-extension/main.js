"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("fs"),n=require("electron"),r=require("path");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=t(e),i=t(r);let a=!1;const c={async setNodeActive(){const e=Editor.Selection.getSelected("node");if(!(e.length<=0))for(let n of e){const e=await Editor.Message.request("scene","query-node",n);await Editor.Message.request("scene","set-property",{uuid:n,path:"active",dump:{type:"Boolean",value:!e.active.value}})}},async onSceneReady(){const e=d();if(e)try{(await e.executeJavaScript("\n                (async () => {\n                    if (window.hierarchy) {\n                        return { initialized: true };\n                    } else {\n                        return { initialized: false };\n                    }\n                })()\n            ")).initialized?a=!0:(a=!1,s())}catch(e){console.error("[hierarchy-extension]","检查层级管理器状态失败:",e),a=!1,s()}else console.error("[hierarchy-extension]","无法获取webContents")}};function s(){if(a){const e=d();return e?void e.executeJavaScript("window.hierarchy !== undefined").then((e=>{e||(a=!1,u())})).catch((()=>{console.error("[hierarchy-extension]","验证层级管理器状态失败，重新注入"),a=!1,u()})):void console.error("[hierarchy-extension]","注入失败: webContents 为空")}u()}function u(){const e=d();if(!e)return void console.error("[hierarchy-extension]","注入失败: webContents 为空");const n=`\n    (async () => {\n        try {\n            // 检查是否已经初始化\n            if (window.hierarchy) {\n                return true;\n            }\n            \n            ${o.default.readFileSync(i.default.join(__dirname,"utils.js"),"utf-8")}\n            ${o.default.readFileSync(i.default.join(__dirname,"hierarchy-init.js"),"utf-8")}\n            \n            // 等待层级管理器初始化完成\n            const ready = await window.hierarchyReady;\n            if (!ready) {\n                console.error('[hierarchy-extension]', '层级管理器初始化失败，扩展加载取消');\n                return false;\n            }\n \n            ${o.default.readFileSync(i.default.join(__dirname,"extensions/node-activator.js"),"utf-8")}\n            ${o.default.readFileSync(i.default.join(__dirname,"extensions/header-node.js"),"utf-8")}\n            return true;\n        } catch (error) {\n            console.error('[hierarchy-extension]', '注入失败:', error);\n            return false;\n        }\n    })()`;e.executeJavaScript(n).then((e=>{a=e,e||console.warn("[hierarchy-extension]","注入未成功")})).catch((e=>{console.error("[hierarchy-extension]","注入失败:",e),a=!1}))}function d(){for(const e of n.BrowserWindow.getAllWindows())try{const n=e.webContents.getURL(),r=e.getTitle()||"";if(n.includes("windows/main.html")||r.includes("Cocos Creator"))return e.webContents}catch(e){console.error("[hierarchy-extension]","获取窗口信息时出错:",e)}return console.error("[hierarchy-extension]","未找到Cocos Creator主窗口"),null}exports.load=function(){s()},exports.methods=c,exports.unload=function(){const e=d();e?(e.executeJavaScript("\n        if (window.hierarchy) {\n            window.hierarchy.cleanup();\n        }\n    ").catch((e=>console.error("[hierarchy-extension]","清理失败:",e))),a=!1):console.error("[hierarchy-extension]","清理失败: webContents 为空")};
