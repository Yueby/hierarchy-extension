"use strict";!function(){let e=null;console.log("初始化前 window:",{hierarchyVue:window.hierarchyVue,hierarchyTree:window.hierarchyTree,hierarchyEvents:window.hierarchyEvents,hierarchyExtension:window.hierarchyExtension}),window.hierarchyVue=function(){var e,n,r;console.log("dock-frame:",document.getElementsByTagName("dock-frame")[0]);const o=new Map,i=null===(e=document.getElementsByTagName("dock-frame")[0].shadowRoot)||void 0===e?void 0:e.querySelectorAll("panel-frame");console.log("panelList:",i),null==i||i.forEach((e=>{const n=e.getAttribute("name");n&&o.set(n,e)})),console.log("panelMap:",o);const t=null===(r=null===(n=o.get("hierarchy"))||void 0===n?void 0:n.shadowRoot)||void 0===r?void 0:r.querySelectorAll("ui-drag-area")[0];return console.log("dragArea:",t,"vue:",t&&t.__vue__),t?t.__vue__:null}(),window.hierarchyTree={nodeMap:new Map,rootNodes:[],getChildren(e){const n=[];return this.nodeMap.forEach((r=>{r.parent===e&&n.push(r)})),n},getParent(e){const n=this.nodeMap.get(e);return n&&this.nodeMap.get(n.parent)||null},isParent(e,n){let r=this.nodeMap.get(e);for(;r;){if(r.parent===n)return!0;r=this.nodeMap.get(r.parent)}return!1}},window.hierarchyEvents={listeners:new Map,emit(e,...n){(this.listeners.get(e)||[]).forEach((e=>e(...n)))},on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)},off(e,n){const r=this.listeners.get(e);if(r){const e=r.indexOf(n);e>-1&&r.splice(e,1)}}},window.hierarchyExtension=function(){const n=new Map;let r="",o="scene";return{add(e){var r,o,i;if(n.has(e.id))throw new Error(`Extension with id ${e.id} already exists`);!function(e,n,r){if(!r)return;const o=window.hierarchyVue;if(!o)return;const i=o.$el,t=`hierarchy-style-${e}`;let s=document.getElementById(t);s||(s=document.createElement("style"),s.id=t,i.appendChild(s)),s.textContent=r}(e.id,e.className,e.style),null===(o=null===(r=e.lifecycle)||void 0===r?void 0:r.onInit)||void 0===o||o.call(r),(null===(i=e.lifecycle)||void 0===i?void 0:i.onAssetChange)&&window.hierarchyEvents.on("onAssetChange",e.lifecycle.onAssetChange);const t=Object.assign(Object.assign({},e),{destroy:()=>{var r,o,i;null===(o=null===(r=e.lifecycle)||void 0===r?void 0:r.onDestroy)||void 0===o||o.call(r),(null===(i=e.lifecycle)||void 0===i?void 0:i.onAssetChange)&&window.hierarchyEvents.off("onAssetChange",e.lifecycle.onAssetChange),function(e){const n=`hierarchy-style-${e}`,r=document.getElementById(n);null==r||r.remove()}(e.id),n.delete(e.id),window.hierarchyEvents.emit("onExtensionRemoved",e.id)}});return n.set(e.id,t),window.hierarchyEvents.emit("onExtensionAdded",t),this.updateAll(),t},get:e=>n.get(e),remove(e){const r=n.get(e);r&&r.destroy()},getAll:()=>Array.from(n.values()),updateAll(){if(e)return;const i=window.hierarchyVue;i&&(i.$children.forEach((e=>{var t,s;const a=e.$el,c=i.nodes.length?"cc.Scene"===i.nodes[0].type?i.nodes[0].uuid:(null===(t=i.nodes[0].prefab)||void 0===t?void 0:t.assetUuid)||"":"",h="cc.Scene"===(null===(s=i.nodes[0])||void 0===s?void 0:s.type)?"scene":"prefab";c!==r&&(r=c,o=h,window.hierarchyEvents.emit("onAssetChange",r,o)),n.forEach((n=>{const r=n.isVisible(e);let o=a.querySelector(`.${n.className}`);r?(r&&!o&&(o=document.createElement("div"),o.className=n.className,a.appendChild(o),n.onCreate(e,o)),o&&n.onUpdate&&n.onUpdate(e,o)):null==o||o.remove()}))})),e=setTimeout((()=>{e=null}),0),window.hierarchyEvents.emit("onTreeUpdate"))}}}(),window.refreshHierarchyTree=function(){const e=window.hierarchyVue,n=window.hierarchyTree;e&&n&&(n.nodeMap.clear(),n.rootNodes=[],e.$children.forEach((r=>{const o=e.nodes.find((e=>e.uuid===r.uuid));if(!o)return;const i=Object.assign(Object.assign({},o),{element:r.$el,vueComponent:r});n.nodeMap.set(i.uuid,i),i.parent||n.rootNodes.push(i)})))},console.log("初始化后 window:",{hierarchyVue:window.hierarchyVue,hierarchyTree:window.hierarchyTree,hierarchyEvents:window.hierarchyEvents,hierarchyExtension:window.hierarchyExtension}),window.hierarchyVue&&(window.hierarchyVue.$watch("nodes",(()=>{console.log("节点变化:",{hierarchyVue:window.hierarchyVue,hierarchyTree:window.hierarchyTree}),window.refreshHierarchyTree(),window.hierarchyExtension.updateAll()})),window.refreshHierarchyTree(),window.hierarchyExtension.updateAll())}();
